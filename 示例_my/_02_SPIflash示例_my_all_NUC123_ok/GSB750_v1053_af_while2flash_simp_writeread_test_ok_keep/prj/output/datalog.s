; generated by ARM C/C++ Compiler, 5.02 [Build 28]
; commandline ArmCC [--split_sections --debug -c --asm --info=totals -o.\output\datalog.o --depend=.\output\datalog.d --cpu=Cortex-M0 --apcs=interwork -I..\CMSIS\CM0\DeviceSupport\Nuvoton\NUC123Series -I..\CMSIS\CM0\CoreSupport -I..\INC\DrvInc -I..\INC\SysInc -IC:\Keil\ARM\RV31\INC -IC:\Keil\ARM\CMSIS\Include -D__MICROLIB --omf_browse=.\output\datalog.crf ..\AppSrc\datalog.c]
        THUMB
        REQUIRE8
        PRESERVE8

        AREA ||i.ReadLogByte||, CODE, READONLY, ALIGN=2

ReadLogByte PROC
        PUSH     {r2-r6,lr}
        MOV      r5,r0
        MOVS     r0,#1
        LDR      r4,|L1.52|
        MOV      r2,r0
        STR      r0,[sp,#0]
        MOVS     r3,#2
        MOVS     r1,#0xa0
        STR      r4,[sp,#4]
        LDR      r0,|L1.56|
        BL       initI2cDataBlock
        STRB     r5,[r4,#1]
        MOVS     r0,#0xff
        STRB     r0,[r4,#2]
        MOVS     r0,#0xa2
        STRB     r0,[r4,#0]
        MOVS     r1,#0
        LDR      r0,|L1.56|
        BL       addI2cChain
|L1.42|
        LDRB     r0,[r4,#0]  ; eprom_buf
        CMP      r0,#0xa2
        BEQ      |L1.42|
        LDRB     r0,[r4,#2]  ; eprom_buf
        POP      {r2-r6,pc}
        ENDP

|L1.52|
        DCD      ||.data||+0x1
|L1.56|
        DCD      ||area_number.16||+0x200

        AREA ||i.ReadOneLog||, CODE, READONLY, ALIGN=1

ReadOneLog PROC
        PUSH     {r3-r5,lr}
        LSLS     r0,r0,#2
        ADDS     r4,r0,#1
        BL       ReadLogByte
        MOV      r1,sp
        STRB     r0,[r1,#0]
        MOV      r0,r4
        ADDS     r4,r4,#1
        BL       ReadLogByte
        MOV      r1,sp
        STRB     r0,[r1,#1]
        ADDS     r5,r4,#1
        MOV      r0,r4
        BL       ReadLogByte
        MOV      r1,sp
        STRB     r0,[r1,#2]
        MOV      r0,r5
        BL       ReadLogByte
        MOV      r1,sp
        STRB     r0,[r1,#3]
        LDR      r0,[sp,#0]
        POP      {r3-r5,pc}
        ENDP


        AREA ||i.WriteLogByte||, CODE, READONLY, ALIGN=2

WriteLogByte PROC
        PUSH     {r2-r6,lr}
        MOV      r6,r0
        MOVS     r0,#1
        MOV      r5,r1
        LDR      r4,|L3.52|
        STR      r0,[sp,#0]
        MOVS     r3,#2
        MOVS     r2,#0
        MOVS     r1,#0xa0
        STR      r4,[sp,#4]
        LDR      r0,|L3.56|
        BL       initI2cDataBlock
        STRB     r5,[r4,#1]
        STRB     r6,[r4,#2]
        MOVS     r0,#0xa2
        STRB     r0,[r4,#0]
        MOVS     r1,#0
        LDR      r0,|L3.56|
        BL       addI2cChain
|L3.42|
        LDRB     r0,[r4,#0]  ; eprom_buf
        CMP      r0,#0xa2
        BEQ      |L3.42|
        POP      {r2-r6,pc}
        ENDP

        DCW      0x0000
|L3.52|
        DCD      ||.data||+0x1
|L3.56|
        DCD      ||area_number.16||+0x200

        AREA ||i.earseAllLog||, CODE, READONLY, ALIGN=1

earseAllLog PROC
        BX       lr
        ENDP


        AREA ||i.logClose||, CODE, READONLY, ALIGN=1

logClose PROC
        BX       lr
        ENDP


        AREA ||i.logEvent||, CODE, READONLY, ALIGN=1

logEvent PROC
        BX       lr
        ENDP


        AREA ||i.logInit||, CODE, READONLY, ALIGN=2

logInit PROC
        PUSH     {r3-r7,lr}
        MOVS     r0,#0
        BL       ReadOneLog
        MOV      r7,r0
        UXTB     r0,r0
        LDR      r6,|L7.700|
        CMP      r0,#0xa5
        BEQ      |L7.154|
        CMP      r0,#0xa3
        BEQ      |L7.164|
        MOVS     r5,#1
        LDR      r4,|L7.704|
        CMP      r0,#0xaa
        BEQ      |L7.216|
        MOVS     r0,#7
        LSLS     r0,r0,#17
        STR      r0,[r6,#0xc]  ; flash_page
        MOVS     r0,#0
        STR      r0,[r6,#8]  ; log_index
        LDR      r0,[r4,#8]
        BICS     r0,r0,r5
        STR      r0,[r4,#8]
        LDR      r0,[r4,#0]
        LSLS     r7,r5,#19
        BICS     r0,r0,r7
        STR      r0,[r4,#0]
        LDR      r0,[r4,#8]
        ORRS     r0,r0,r5
        STR      r0,[r4,#8]
        MOVS     r1,#8
        MOVS     r0,#6
        BL       spiSendWord
        LDR      r0,[r4,#8]
        BICS     r0,r0,r5
        STR      r0,[r4,#8]
        NOP      
        LDR      r0,[r4,#8]
        ORRS     r0,r0,r5
        STR      r0,[r4,#8]
        MOVS     r1,#8
        MOVS     r0,#0xd8
        BL       spiSendWord
        MOVS     r1,#0x18
        LDR      r0,[r6,#0xc]  ; flash_page
        BL       spiSendWord
        LDR      r0,[r4,#8]
        LSRS     r0,r0,#1
        LSLS     r0,r0,#1
        STR      r0,[r4,#8]
        MOVS     r0,#0xc8
        BL       sysDelayMs
        LDR      r0,[r4,#8]
        LSRS     r0,r0,#1
        LSLS     r0,r0,#1
        STR      r0,[r4,#8]
        LDR      r0,[r4,#0]
        BICS     r0,r0,r7
        STR      r0,[r4,#0]
        LDR      r0,[r4,#8]
        ORRS     r0,r0,r5
        STR      r0,[r4,#8]
        MOVS     r1,#8
        MOVS     r0,#5
        BL       spiSendWord
        MOVS     r1,#8
        MOVS     r0,#0xff
        BL       spiSendWord
        LDR      r0,[r4,#0x10]
        LDR      r6,|L7.708|
        B        |L7.680|
|L7.154|
        LSRS     r0,r7,#8
        STR      r0,[r6,#0xc]  ; flash_page
        MOVS     r0,#0
        STR      r0,[r6,#8]  ; log_index
        POP      {r3-r7,pc}
|L7.164|
        LSRS     r0,r7,#8
        STR      r0,[r6,#0xc]  ; flash_page
        MOVS     r0,#0x3f
        BL       ReadOneLog
        STR      r0,[r6,#8]  ; log_index
        CMP      r0,#0x3f
        BLS      |L7.190|
        MOVS     r0,#0
        BL       ReadOneLog
        MOV      r7,r0
        B        |L7.154|
|L7.190|
        MOVS     r4,#0
        LDR      r5,|L7.712|
        B        |L7.208|
|L7.196|
        MOV      r0,r4
        BL       ReadOneLog
        LSLS     r1,r4,#2
        STR      r0,[r5,r1]
        ADDS     r4,r4,#1
|L7.208|
        LDR      r0,[r6,#8]  ; log_index
        CMP      r4,r0
        BCC      |L7.196|
|L7.214|
        POP      {r3-r7,pc}
|L7.216|
        LDR      r0,|L7.700|
        MOVS     r6,#0
        STR      r5,[r0,#4]  ; flash_w
|L7.222|
        MOV      r0,r6
        BL       ReadOneLog
        LSLS     r2,r6,#2
        LDR      r1,|L7.712|
        ADDS     r6,r6,#1
        STR      r0,[r1,r2]
        CMP      r6,#0x40
        BCC      |L7.222|
        MOV      r2,r1
        LDR      r6,|L7.700|
        MOVS     r1,#0xff
        ADDS     r1,#1
        LDR      r0,[r6,#0xc]  ; flash_page
        BL       spiFlashPageWrite
        MOVS     r0,#0
        STR      r0,[r6,#4]  ; flash_w
        STR      r0,[r6,#8]  ; log_index
        LSRS     r0,r7,#8
        ADDS     r0,r0,#0xff
        ADDS     r0,#1
        LSLS     r1,r0,#16
        STR      r0,[r6,#0xc]  ; flash_page
        LSRS     r1,r1,#16
        BNE      |L7.214|
        MOVS     r7,#7
        LSLS     r7,r7,#17
        CMP      r0,r7
        BNE      |L7.354|
        LDR      r0,[r4,#8]
        LSRS     r0,r0,#1
        LSLS     r0,r0,#1
        STR      r0,[r4,#8]
        LDR      r1,[r4,#0]
        MOVS     r0,#1
        LSLS     r0,r0,#19
        BICS     r1,r1,r0
        STR      r1,[r4,#0]
        LDR      r0,[r4,#8]
        ORRS     r0,r0,r5
        STR      r0,[r4,#8]
        MOVS     r1,#8
        MOVS     r0,#6
        BL       spiSendWord
        LDR      r0,[r4,#8]
        LSRS     r0,r0,#1
        LSLS     r0,r0,#1
        STR      r0,[r4,#8]
        NOP      
        LDR      r0,[r4,#8]
        ORRS     r0,r0,r5
        STR      r0,[r4,#8]
        MOVS     r1,#8
        MOVS     r0,#0xd8
        BL       spiSendWord
        MOVS     r1,#0x18
        MOV      r0,r7
        BL       spiSendWord
        LDR      r0,[r4,#8]
        LSRS     r0,r0,#1
        LSLS     r0,r0,#1
        STR      r0,[r4,#8]
|L7.354|
        MOVS     r0,#0xf
        LDR      r1,[r6,#0xc]  ; flash_page
        LSLS     r0,r0,#16
        CMP      r1,r0
        BNE      |L7.438|
        LDR      r0,[r4,#8]
        LSRS     r0,r0,#1
        LSLS     r0,r0,#1
        STR      r0,[r4,#8]
        LDR      r1,[r4,#0]
        MOVS     r0,#1
        LSLS     r0,r0,#19
        BICS     r1,r1,r0
        STR      r1,[r4,#0]
        LDR      r0,[r4,#8]
        ORRS     r0,r0,r5
        STR      r0,[r4,#8]
        MOVS     r1,#8
        MOVS     r0,#6
        BL       spiSendWord
        LDR      r0,[r4,#8]
        LSRS     r0,r0,#1
        LSLS     r0,r0,#1
        STR      r0,[r4,#8]
        NOP      
        LDR      r0,[r4,#8]
        ORRS     r0,r0,r5
        STR      r0,[r4,#8]
        MOVS     r1,#8
        MOVS     r0,#0xd8
        BL       spiSendWord
        MOVS     r0,#0xf
        MOVS     r1,#0x18
        LSLS     r0,r0,#16
        BL       spiSendWord
        LDR      r0,[r4,#8]
        LSRS     r0,r0,#1
        LSLS     r0,r0,#1
        STR      r0,[r4,#8]
|L7.438|
        MOVS     r1,#1
        LDR      r0,[r6,#0xc]  ; flash_page
        LSLS     r1,r1,#20
        CMP      r0,r1
        BNE      |L7.522|
        LDR      r0,[r4,#8]
        LSRS     r0,r0,#1
        LSLS     r0,r0,#1
        STR      r0,[r4,#8]
        LDR      r1,[r4,#0]
        MOVS     r0,#1
        LSLS     r0,r0,#19
        BICS     r1,r1,r0
        STR      r1,[r4,#0]
        LDR      r0,[r4,#8]
        ORRS     r0,r0,r5
        STR      r0,[r4,#8]
        MOVS     r1,#8
        MOVS     r0,#6
        BL       spiSendWord
        LDR      r0,[r4,#8]
        LSRS     r0,r0,#1
        LSLS     r0,r0,#1
        STR      r0,[r4,#8]
        NOP      
        LDR      r0,[r4,#8]
        ORRS     r0,r0,r5
        STR      r0,[r4,#8]
        MOVS     r1,#8
        MOVS     r0,#0xd8
        BL       spiSendWord
        MOVS     r1,#0x18
        MOV      r0,r7
        BL       spiSendWord
        LDR      r0,[r4,#8]
        LSRS     r0,r0,#1
        LSLS     r0,r0,#1
        STR      r0,[r4,#8]
        STR      r7,[r6,#0xc]  ; flash_page
|L7.522|
        MOVS     r0,#0xc8
        BL       sysDelayMs
        LDR      r0,[r4,#8]
        LSRS     r0,r0,#1
        LSLS     r0,r0,#1
        STR      r0,[r4,#8]
        LDR      r0,[r4,#0]
        MOVS     r7,#1
        LSLS     r7,r7,#19
        BICS     r0,r0,r7
        STR      r0,[r4,#0]
        LDR      r0,[r4,#8]
        ORRS     r0,r0,r5
        STR      r0,[r4,#8]
        MOVS     r1,#8
        MOVS     r0,#5
        BL       spiSendWord
        MOVS     r1,#8
        MOVS     r0,#0xff
        BL       spiSendWord
        LDR      r0,[r4,#0x10]
        LDR      r6,|L7.708|
        B        |L7.618|
|L7.574|
        MOVS     r0,#0xc8
        BL       sysDelayMs
        LDR      r0,[r4,#8]
        LSRS     r0,r0,#1
        LSLS     r0,r0,#1
        STR      r0,[r4,#8]
        LDR      r0,[r4,#0]
        BICS     r0,r0,r7
        STR      r0,[r4,#0]
        LDR      r0,[r4,#8]
        ORRS     r0,r0,r5
        STR      r0,[r4,#8]
        MOVS     r1,#8
        MOVS     r0,#5
        BL       spiSendWord
        MOVS     r1,#8
        MOVS     r0,#0xff
        BL       spiSendWord
        LDR      r0,[r4,#0x10]
|L7.618|
        STRB     r0,[r6,#0]
        LDR      r0,[r4,#8]
        LSRS     r0,r0,#1
        LSLS     r0,r0,#1
        STR      r0,[r4,#8]
        LDRB     r0,[r6,#0]  ; flash_status
        LSLS     r0,r0,#31
        BNE      |L7.574|
        POP      {r3-r7,pc}
|L7.636|
        MOVS     r0,#0xc8
        BL       sysDelayMs
        LDR      r0,[r4,#8]
        LSRS     r0,r0,#1
        LSLS     r0,r0,#1
        STR      r0,[r4,#8]
        LDR      r0,[r4,#0]
        BICS     r0,r0,r7
        STR      r0,[r4,#0]
        LDR      r0,[r4,#8]
        ORRS     r0,r0,r5
        STR      r0,[r4,#8]
        MOVS     r1,#8
        MOVS     r0,#5
        BL       spiSendWord
        MOVS     r1,#8
        MOVS     r0,#0xff
        BL       spiSendWord
        LDR      r0,[r4,#0x10]
|L7.680|
        STRB     r0,[r6,#0]
        LDR      r0,[r4,#8]
        LSRS     r0,r0,#1
        LSLS     r0,r0,#1
        STR      r0,[r4,#8]
        LDRB     r0,[r6,#0]  ; flash_status
        LSLS     r0,r0,#31
        BNE      |L7.636|
        POP      {r3-r7,pc}
        ENDP

        DCW      0x0000
|L7.700|
        DCD      ||.data||
|L7.704|
        DCD      0x40130000
|L7.708|
        DCD      flash_status
|L7.712|
        DCD      ||area_number.16||

        AREA ||i.printLog||, CODE, READONLY, ALIGN=1

printLog PROC
        BX       lr
        ENDP


        AREA ||i.spiSendWord||, CODE, READONLY, ALIGN=2

spiSendWord PROC
        PUSH     {r4,lr}
        LDR      r2,|L9.44|
        LDR      r3,[r2,#0]
        MOVS     r4,#0xf8
        BICS     r3,r3,r4
        CMP      r1,#0x20
        BNE      |L9.16|
        MOVS     r1,#0
|L9.16|
        LSLS     r1,r1,#3
        ORRS     r3,r3,r1
        STR      r3,[r2,#0]
        STR      r0,[r2,#0x20]
        LDR      r0,[r2,#0]
        MOVS     r1,#1
        ORRS     r0,r0,r1
        STR      r0,[r2,#0]
|L9.32|
        LDR      r0,[r2,#0]
        LSLS     r0,r0,#31
        LSRS     r0,r0,#31
        BNE      |L9.32|
        POP      {r4,pc}
        ENDP

        DCW      0x0000
|L9.44|
        DCD      0x40130000

        AREA ||i.writeFlashPage||, CODE, READONLY, ALIGN=2

writeFlashPage PROC
        PUSH     {r3-r7,lr}
        LDR      r0,|L10.420|
        LDR      r7,|L10.424|
        LDRB     r0,[r0,#0]  ; flash_mode
        CMP      r0,#0
        BEQ      |L10.26|
        LDR      r3,|L10.428|
        MOVS     r2,#0
        MOVS     r1,#0x1e
        LDRB     r0,[r7,#0]  ; log_id
        BL       startATask
|L10.24|
        POP      {r3-r7,pc}
|L10.26|
        MOVS     r5,#1
        STR      r5,[r7,#4]  ; flash_w
        LDR      r2,[r7,#0x10]  ; ptrlog
        MOVS     r0,#0xaa
        STRB     r0,[r2,#0]
        LSLS     r1,r5,#8
        LDR      r0,[r7,#0xc]  ; flash_page
        BL       spiFlashPageWrite
        MOVS     r0,#0
        STR      r0,[r7,#4]  ; flash_w
        LDR      r0,[r7,#0xc]  ; flash_page
        MOVS     r1,#0
        ADDS     r0,r0,#0xff
        ADDS     r0,#1
        STR      r0,[r7,#0xc]  ; flash_page
        MOVS     r0,#0xa5
        BL       WriteLogByte
        LDR      r0,[r7,#0xc]  ; flash_page
        LSLS     r1,r0,#16
        LSRS     r1,r1,#16
        BNE      |L10.24|
        MOVS     r1,#7
        LSLS     r1,r1,#17
        LDR      r4,|L10.432|
        LSLS     r6,r5,#19
        CMP      r0,r1
        BNE      |L10.148|
        LDR      r0,[r4,#8]
        BICS     r0,r0,r5
        STR      r0,[r4,#8]
        LDR      r0,[r4,#0]
        BICS     r0,r0,r6
        STR      r0,[r4,#0]
        LDR      r0,[r4,#8]
        ORRS     r0,r0,r5
        STR      r0,[r4,#8]
        MOVS     r1,#8
        MOVS     r0,#6
        BL       spiSendWord
        LDR      r0,[r4,#8]
        BICS     r0,r0,r5
        STR      r0,[r4,#8]
        NOP      
        LDR      r0,[r4,#8]
        ORRS     r0,r0,r5
        STR      r0,[r4,#8]
        MOVS     r1,#8
        MOVS     r0,#0xd8
        BL       spiSendWord
        MOVS     r1,#0x18
        LDR      r0,[r7,#0xc]  ; flash_page
        BL       spiSendWord
        LDR      r0,[r4,#8]
        LSRS     r0,r0,#1
        LSLS     r0,r0,#1
        STR      r0,[r4,#8]
|L10.148|
        MOVS     r1,#0xf
        LDR      r0,[r7,#0xc]  ; flash_page
        LSLS     r1,r1,#16
        CMP      r0,r1
        BNE      |L10.226|
        LDR      r0,[r4,#8]
        LSRS     r0,r0,#1
        LSLS     r0,r0,#1
        STR      r0,[r4,#8]
        LDR      r0,[r4,#0]
        BICS     r0,r0,r6
        STR      r0,[r4,#0]
        LDR      r0,[r4,#8]
        ORRS     r0,r0,r5
        STR      r0,[r4,#8]
        MOVS     r1,#8
        MOVS     r0,#6
        BL       spiSendWord
        LDR      r0,[r4,#8]
        LSRS     r0,r0,#1
        LSLS     r0,r0,#1
        STR      r0,[r4,#8]
        NOP      
        LDR      r0,[r4,#8]
        ORRS     r0,r0,r5
        STR      r0,[r4,#8]
        MOVS     r1,#8
        MOVS     r0,#0xd8
        BL       spiSendWord
        MOVS     r1,#0x18
        LDR      r0,[r7,#0xc]  ; flash_page
        BL       spiSendWord
        LDR      r0,[r4,#8]
        LSRS     r0,r0,#1
        LSLS     r0,r0,#1
        STR      r0,[r4,#8]
|L10.226|
        MOVS     r1,#1
        LDR      r0,[r7,#0xc]  ; flash_page
        LSLS     r1,r1,#20
        CMP      r0,r1
        BNE      |L10.310|
        MOVS     r0,#7
        LSLS     r0,r0,#17
        STR      r0,[r7,#0xc]  ; flash_page
        LDR      r0,[r4,#8]
        LSRS     r0,r0,#1
        LSLS     r0,r0,#1
        STR      r0,[r4,#8]
        LDR      r0,[r4,#0]
        BICS     r0,r0,r6
        STR      r0,[r4,#0]
        LDR      r0,[r4,#8]
        ORRS     r0,r0,r5
        STR      r0,[r4,#8]
        MOVS     r1,#8
        MOVS     r0,#6
        BL       spiSendWord
        LDR      r0,[r4,#8]
        LSRS     r0,r0,#1
        LSLS     r0,r0,#1
        STR      r0,[r4,#8]
        NOP      
        LDR      r0,[r4,#8]
        ORRS     r0,r0,r5
        STR      r0,[r4,#8]
        MOVS     r1,#8
        MOVS     r0,#0xd8
        BL       spiSendWord
        MOVS     r1,#0x18
        LDR      r0,[r7,#0xc]  ; flash_page
        BL       spiSendWord
        LDR      r0,[r4,#8]
        LSRS     r0,r0,#1
        LSLS     r0,r0,#1
        STR      r0,[r4,#8]
|L10.310|
        MOVS     r0,#0xc8
        BL       sysDelayMs
        LDR      r0,[r4,#8]
        LSRS     r0,r0,#1
        LSLS     r0,r0,#1
        STR      r0,[r4,#8]
        LDR      r0,[r4,#0]
        BICS     r0,r0,r6
        STR      r0,[r4,#0]
        LDR      r0,[r4,#8]
        ORRS     r0,r0,r5
        STR      r0,[r4,#8]
        MOVS     r1,#8
        MOVS     r0,#5
        BL       spiSendWord
        MOVS     r1,#8
        MOVS     r0,#0xff
        BL       spiSendWord
        LDR      r0,[r4,#0x10]
        LDR      r7,|L10.436|
        B        |L10.402|
|L10.358|
        MOVS     r0,#0xc8
        BL       sysDelayMs
        LDR      r0,[r4,#8]
        LSRS     r0,r0,#1
        LSLS     r0,r0,#1
        STR      r0,[r4,#8]
        LDR      r0,[r4,#0]
        BICS     r0,r0,r6
        STR      r0,[r4,#0]
        LDR      r0,[r4,#8]
        ORRS     r0,r0,r5
        STR      r0,[r4,#8]
        MOVS     r1,#8
        MOVS     r0,#5
        BL       spiSendWord
        MOVS     r1,#8
        MOVS     r0,#0xff
        BL       spiSendWord
        LDR      r0,[r4,#0x10]
|L10.402|
        STRB     r0,[r7,#0]
        LDR      r0,[r4,#8]
        LSRS     r0,r0,#1
        LSLS     r0,r0,#1
        STR      r0,[r4,#8]
        LDRB     r0,[r7,#0]  ; flash_status
        LSLS     r0,r0,#31
        BNE      |L10.358|
        POP      {r3-r7,pc}
        ENDP

|L10.420|
        DCD      flash_mode
|L10.424|
        DCD      ||.data||
|L10.428|
        DCD      writeFlashPage
|L10.432|
        DCD      0x40130000
|L10.436|
        DCD      flash_status

        AREA ||i.writeLogPage||, CODE, READONLY, ALIGN=2

writeLogPage PROC
        PUSH     {r4,lr}
        LDR      r4,|L11.20|
        LDR      r3,|L11.24|
        STR      r0,[r4,#0x10]  ; ptrlog
        MOVS     r2,#0
        MOVS     r1,#3
        LDRB     r0,[r4,#0]  ; log_id
        BL       startATask
        POP      {r4,pc}
        ENDP

|L11.20|
        DCD      ||.data||
|L11.24|
        DCD      writeFlashPage

        AREA ||i.writeOneLog||, CODE, READONLY, ALIGN=1

writeOneLog PROC
        PUSH     {r3-r5,lr}
        STR      r0,[sp,#0]
        LSLS     r0,r1,#26
        LSRS     r1,r0,#24
        ADDS     r0,r1,#1
        UXTB     r4,r0
        MOV      r0,sp
        LDRB     r0,[r0,#0]
        BL       WriteLogByte
        ADDS     r0,r4,#1
        UXTB     r5,r0
        MOV      r0,sp
        LDRB     r0,[r0,#1]
        MOV      r1,r4
        BL       WriteLogByte
        MOV      r1,r5
        ADDS     r5,r5,#1
        MOV      r0,sp
        UXTB     r4,r5
        LDRB     r0,[r0,#2]
        BL       WriteLogByte
        MOV      r0,sp
        LDRB     r0,[r0,#3]
        MOV      r1,r4
        BL       WriteLogByte
        POP      {r3-r5,pc}
        ENDP


        AREA ||.arm_vfe_header||, DATA, READONLY, NOALLOC, ALIGN=2

        DCD      0x00000000

        AREA ||.bss||, DATA, NOINIT, ALIGN=2

logbuf
        %        512

        AREA ||area_number.15||, DATA, NOINIT, ALIGN=2

        EXPORTAS ||area_number.15||, ||.bss||
temp_buf
        %        256

        AREA ||area_number.16||, DATA, NOINIT, ALIGN=2

        EXPORTAS ||area_number.16||, ||.bss||
log_buf
        %        512
eprom_block
        %        16

        AREA ||.conststring||, DATA, READONLY, MERGE=1, STRINGS, ALIGN=0

        DCB      "un_used",0
        DCB      "Time_stamp_wrapped",0
        DCB      "Power_up_sequence_started",0
        DCB      "Power_down_sequence_started",0
        DCB      "Amplifier_mute",0
        DCB      "Amplifier_unmute",0
        DCB      "System_power_on",0
        DCB      "System_standby",0
        DCB      "system_power_off",0
        DCB      "NFC_touch_detected",0
        DCB      "NFC_removed",0
        DCB      "key_power_pressed",0
        DCB      "key_vol_add_pressed",0
        DCB      "key_vol_dec_pressed",0
        DCB      "key_source_pressed",0
        DCB      "key_source_long_pressed",0
        DCB      "key_u_pressed",0
        DCB      "key_v_pressed",0
        DCB      "key_w_pressed",0
        DCB      "key_x_pressed",0
        DCB      "key_y_pressed",0
        DCB      "key_z_pressed",0
        DCB      "RC_key1_pressed",0
        DCB      "RC_key2_pressed",0
        DCB      "RC_key3_pressed",0
        DCB      "RC_key4_pressed",0
        DCB      "RC_key5_pressed",0
        DCB      "RC_key6_pressed",0
        DCB      "RC_key7_pressed",0
        DCB      "RC_key8_pressed",0
        DCB      "RC_key9_pressed",0
        DCB      "RC_key10_pressed",0
        DCB      "RC_key11_pressed",0
        DCB      "RC_key12_pressed",0
        DCB      "RC_key13_pressed",0
        DCB      "RC_key14_pressed",0
        DCB      "RC_key15_pressed",0
        DCB      "RC_key16_pressed",0
        DCB      "RC_key17_pressed",0
        DCB      "RC_key18_pressed",0
        DCB      "RC_key19_pressed",0
        DCB      "RC_key20_pressed",0
        DCB      "RC_key21_pressed",0
        DCB      "RC_key22_pressed",0
        DCB      "RC_key23_pressed",0
        DCB      "RC_key24_pressed",0
        DCB      "RC_key25_pressed",0
        DCB      "RC_key26_pressed",0
        DCB      "RC_key27_pressed",0
        DCB      "RC_key28_pressed",0
        DCB      "RC_key29_pressed",0
        DCB      "RC_key30_pressed",0
        DCB      "RC_key31_pressed",0
        DCB      "RC_key32_pressed",0
        DCB      "call_in",0
        DCB      "call_out",0
        DCB      "call_pickup",0
        DCB      "call_hangup",0
        DCB      "bt_pairing",0
        DCB      "bt_paired",0
        DCB      "bt_power_down",0
        DCB      "bt_disconnect",0
        DCB      "demo_mode_pressed",0
        DCB      "Gesture_event1",0
        DCB      "Gesture_event2",0
        DCB      "Gesture_event3",0
        DCB      "Gesture_event4",0
        DCB      "Gesture_event5",0
        DCB      "Gesture_event6",0
        DCB      "Gesture_event7",0
        DCB      "amp_init_start",0
        DCB      "amp_init_ok",0
        DCB      "amp_i2c_werror",0
        DCB      "amp_i2c_rerror",0
        DCB      "Main_enclosure_over_temp_warning",0
        DCB      "Amplifier1_over_temp_warning",0
        DCB      "Amplifier2_over_temp_warning",0
        DCB      "Amplifier3_over_temp_warning",0
        DCB      "Amplifier1_thermal_shutdown",0
        DCB      "Amplifier2_thermal_shutdown",0
        DCB      "Amplifier3_thermal_shutdown",0
        DCB      "Amplifier1_overcurrent_shutdown",0
        DCB      "Amplifier2_overcurrent_shutdown",0
        DCB      "Amplifier3_overcurrent_shutdown",0
        DCB      "GSensor_event1",0
        DCB      "GSensor_event2",0
        DCB      "GSensor_event3",0
        DCB      "GSensor_event4",0
        DCB      "GSensor_event5",0
        DCB      "GSensor_event6",0
        DCB      "GSensor_event7",0
        DCB      "GSensor_event8",0
        DCB      "GSensor_event9",0
        DCB      "GSensor_event10",0
        DCB      "Overvoltage_on_DC_input",0
        DCB      "Battery_full",0
        DCB      "Battery_low",0
        DCB      "Battery_chargin",0
        DCB      "DC_inserted",0
        DCB      "DC_removed",0
        DCB      "Phone_call_detected",0
        DCB      "Phone_call_ended",0
        DCB      "SPDIF_source1_detected",0
        DCB      "SPDIF_source2_detected",0
        DCB      "SPDIF_source3_detected",0
        DCB      "SPDIF_source4_detected",0
        DCB      "BLUETOOTH_SOURE_IN",0
        DCB      "AUX_SOURCE_IN",0
        DCB      "LINEIN_SOUTCE_IN",0
        DCB      "Flash_audio_track1_started",0
        DCB      "Flash_audio_track2_started",0
        DCB      "Flash_audio_track3_started",0
        DCB      "Flash_audio_track4_started",0
        DCB      "Flash_audio_track5_started",0
        DCB      "Flash_audio_track6_started",0
        DCB      "Flash_audio_track7_started",0
        DCB      "Flash_audio_track8_started",0
        DCB      "Flash_audio_track1_finished",0
        DCB      "Flash_audio_track2_finished",0
        DCB      "Flash_audio_track3_finished",0
        DCB      "Flash_audio_track4_finished",0
        DCB      "Flash_audio_track5_finished",0
        DCB      "Flash_audio_track6_finished",0
        DCB      "Flash_audio_track7_finished",0
        DCB      "Flash_audio_track8_finished",0
        DCB      "BT_in_pairing_mode",0
        DCB      "BT_forced_into_pairing_mode",0
        DCB      "BT_pairing_complete",0
        DCB      "No_audio_present_for10_mins",0
        DCB      "No_audio_present_for30_mins",0
        DCB      "Led_dark_color",0
        DCB      "Led_red_color",0
        DCB      "Led_green_color",0
        DCB      "Led_blue_color",0
        DCB      "Led_yellow_color",0
        DCB      "Led_purple_color",0
        DCB      "Led_white_color",0
        DCB      "Led_soe_color",0
        DCB      "Led_light_blue_color",0
        DCB      "Led_bluetooth_color",0
        DCB      "flash_error_page",0
        DCB      "watch_dog_reset",0

        AREA ||.data||, DATA, ALIGN=2

log_id
        DCB      0xff
eprom_buf
        DCB      0x00,0x00,0x00
flash_w
        DCD      0x00000000
log_index
        DCD      0x00000000
flash_page
        DCD      0x00000000
ptrlog
        DCD      0x00000000

        AREA ||area_number.20||, DATA, ALIGN=0

        EXPORTAS ||area_number.20||, ||.data||
event
        DCB      0x00

        AREA ||area_number.21||, DATA, ALIGN=2

        EXPORTAS ||area_number.21||, ||.data||
logInfo
        DCD      ||.conststring||
        DCD      ||.conststring||+0x8
        DCD      ||.conststring||+0x1b
        DCD      ||.conststring||+0x35
        DCD      ||.conststring||+0x51
        DCD      ||.conststring||+0x60
        DCD      ||.conststring||+0x71
        DCD      ||.conststring||+0x81
        DCD      ||.conststring||+0x90
        DCD      ||.conststring||+0xa1
        DCD      ||.conststring||+0xb4
        DCD      ||.conststring||+0xc0
        DCD      ||.conststring||+0xd2
        DCD      ||.conststring||+0xe6
        DCD      ||.conststring||+0xfa
        DCD      ||.conststring||+0x10d
        DCD      ||.conststring||+0x125
        DCD      ||.conststring||+0x133
        DCD      ||.conststring||+0x141
        DCD      ||.conststring||+0x14f
        DCD      ||.conststring||+0x15d
        DCD      ||.conststring||+0x16b
        DCD      ||.conststring||+0x179
        DCD      ||.conststring||+0x189
        DCD      ||.conststring||+0x199
        DCD      ||.conststring||+0x1a9
        DCD      ||.conststring||+0x1b9
        DCD      ||.conststring||+0x1c9
        DCD      ||.conststring||+0x1d9
        DCD      ||.conststring||+0x1e9
        DCD      ||.conststring||+0x1f9
        DCD      ||.conststring||+0x209
        DCD      ||.conststring||+0x21a
        DCD      ||.conststring||+0x22b
        DCD      ||.conststring||+0x23c
        DCD      ||.conststring||+0x24d
        DCD      ||.conststring||+0x25e
        DCD      ||.conststring||+0x26f
        DCD      ||.conststring||+0x280
        DCD      ||.conststring||+0x291
        DCD      ||.conststring||+0x2a2
        DCD      ||.conststring||+0x2b3
        DCD      ||.conststring||+0x2c4
        DCD      ||.conststring||+0x2d5
        DCD      ||.conststring||+0x2e6
        DCD      ||.conststring||+0x2f7
        DCD      ||.conststring||+0x308
        DCD      ||.conststring||+0x319
        DCD      ||.conststring||+0x32a
        DCD      ||.conststring||+0x33b
        DCD      ||.conststring||+0x34c
        DCD      ||.conststring||+0x35d
        DCD      ||.conststring||+0x36e
        DCD      ||.conststring||+0x37f
        DCD      ||.conststring||+0x390
        DCD      ||.conststring||+0x398
        DCD      ||.conststring||+0x3a1
        DCD      ||.conststring||+0x3ad
        DCD      ||.conststring||+0x3b9
        DCD      ||.conststring||+0x3c4
        DCD      ||.conststring||+0x3ce
        DCD      ||.conststring||+0x3dc
        DCD      ||.conststring||+0x3ea
        DCD      ||.conststring||+0x3fc
        DCD      ||.conststring||+0x40b
        DCD      ||.conststring||+0x41a
        DCD      ||.conststring||+0x429
        DCD      ||.conststring||+0x438
        DCD      ||.conststring||+0x447
        DCD      ||.conststring||+0x456
        DCD      ||.conststring||+0x465
        DCD      ||.conststring||+0x474
        DCD      ||.conststring||+0x480
        DCD      ||.conststring||+0x48f
        DCD      ||.conststring||+0x49e
        DCD      ||.conststring||+0x4bf
        DCD      ||.conststring||+0x4dc
        DCD      ||.conststring||+0x4f9
        DCD      ||.conststring||+0x516
        DCD      ||.conststring||+0x532
        DCD      ||.conststring||+0x54e
        DCD      ||.conststring||+0x56a
        DCD      ||.conststring||+0x58a
        DCD      ||.conststring||+0x5aa
        DCD      ||.conststring||+0x5ca
        DCD      ||.conststring||+0x5d9
        DCD      ||.conststring||+0x5e8
        DCD      ||.conststring||+0x5f7
        DCD      ||.conststring||+0x606
        DCD      ||.conststring||+0x615
        DCD      ||.conststring||+0x624
        DCD      ||.conststring||+0x633
        DCD      ||.conststring||+0x642
        DCD      ||.conststring||+0x651
        DCD      ||.conststring||+0x661
        DCD      ||.conststring||+0x679
        DCD      ||.conststring||+0x686
        DCD      ||.conststring||+0x692
        DCD      ||.conststring||+0x6a2
        DCD      ||.conststring||+0x6ae
        DCD      ||.conststring||+0x6b9
        DCD      ||.conststring||+0x6cd
        DCD      ||.conststring||+0x6de
        DCD      ||.conststring||+0x6f5
        DCD      ||.conststring||+0x70c
        DCD      ||.conststring||+0x723
        DCD      ||.conststring||+0x73a
        DCD      ||.conststring||+0x74d
        DCD      ||.conststring||+0x75b
        DCD      ||.conststring||+0x76c
        DCD      ||.conststring||+0x787
        DCD      ||.conststring||+0x7a2
        DCD      ||.conststring||+0x7bd
        DCD      ||.conststring||+0x7d8
        DCD      ||.conststring||+0x7f3
        DCD      ||.conststring||+0x80e
        DCD      ||.conststring||+0x829
        DCD      ||.conststring||+0x844
        DCD      ||.conststring||+0x860
        DCD      ||.conststring||+0x87c
        DCD      ||.conststring||+0x898
        DCD      ||.conststring||+0x8b4
        DCD      ||.conststring||+0x8d0
        DCD      ||.conststring||+0x8ec
        DCD      ||.conststring||+0x908
        DCD      ||.conststring||+0x924
        DCD      ||.conststring||+0x937
        DCD      ||.conststring||+0x953
        DCD      ||.conststring||+0x967
        DCD      ||.conststring||+0x983
        DCD      ||.conststring||+0x99f
        DCD      ||.conststring||+0x9ae
        DCD      ||.conststring||+0x9bc
        DCD      ||.conststring||+0x9cc
        DCD      ||.conststring||+0x9db
        DCD      ||.conststring||+0x9ec
        DCD      ||.conststring||+0x9fd
        DCD      ||.conststring||+0xa0d
        DCD      ||.conststring||+0xa1b
        DCD      ||.conststring||+0xa30
        DCD      ||.conststring||+0xa44
        DCD      ||.conststring||+0xa55

        AREA ||area_number.22||, DATA, ALIGN=2

        EXPORTAS ||area_number.22||, ||.data||
flash_start
        DCD      0x00000000

        EXPORT ReadLogByte [CODE]
        EXPORT ReadOneLog [CODE]
        EXPORT WriteLogByte [CODE]
        EXPORT earseAllLog [CODE]
        EXPORT logClose [CODE]
        EXPORT logEvent [CODE]
        EXPORT logInit [CODE]
        EXPORT printLog [CODE]
        EXPORT writeFlashPage [CODE]
        EXPORT writeLogPage [CODE]
        EXPORT writeOneLog [CODE]
        EXPORT logbuf [DATA,SIZE=512]
        EXPORT temp_buf [DATA,SIZE=256]
        EXPORT log_buf [DATA,SIZE=512]
        EXPORT log_id [DATA,SIZE=1]
        EXPORT flash_w [DATA,SIZE=4]
        EXPORT flash_page [DATA,SIZE=4]
        EXPORT event [DATA,SIZE=1]
        EXPORT logInfo [DATA,SIZE=568]
        EXPORT flash_start [DATA,SIZE=4]

        IMPORT ||Lib$$Request$$armlib|| [CODE,WEAK]
        IMPORT initI2cDataBlock [CODE]
        IMPORT addI2cChain [CODE]
        IMPORT spiFlashPageWrite [CODE]
        IMPORT sysDelayMs [CODE]
        IMPORT startATask [CODE]
        IMPORT flash_mode [DATA]
        IMPORT flash_status [DATA]

        KEEP spiSendWord
        KEEP eprom_block
        KEEP eprom_buf
        KEEP log_index
        KEEP ptrlog

        ATTR FILESCOPE
        ATTR SETVALUE Tag_ABI_PCS_wchar_t,2
        ATTR SETVALUE Tag_ABI_enum_size,1
        ATTR SETVALUE Tag_ABI_optimization_goals,3
        ATTR SETSTRING Tag_conformance,"2.06"
        ATTR SETVALUE AV,18,1

        ASSERT {ENDIAN} = "little"
        ASSERT {INTER} = {TRUE}
        ASSERT {ROPI} = {FALSE}
        ASSERT {RWPI} = {FALSE}
        ASSERT {IEEE_FULL} = {FALSE}
        ASSERT {IEEE_PART} = {FALSE}
        ASSERT {IEEE_JAVA} = {FALSE}
        END
